{"version":3,"sources":["../../app-es6/dao/NegociacaoDao.js"],"names":["Negociacao","NegociacaoDao","connection","_store","_connection","negociacao","Promise","resolve","reject","request","transaction","objectStore","add","onsuccess","e","onerror","target","error","cursor","openCursor","negociacoes","_processaResultadoCursor","result","resultado","_processaItem","value","push","continue","item","_data","_quantidade","_valor","clear"],"mappings":";;;;;;;;;;;;;;;AAAQA,sB,qBAAAA,U;;;;;;;;;;;;;;;;;;;;;qCAEKC,a;AAET,uCAAYC,UAAZ,EAAuB;AAAA;;AACnB,yBAAKC,MAAL,GAAc,YAAd;AACA,yBAAKC,WAAL,GAAmBF,UAAnB;AACH;;;;6CAEQG,U,EAAW;AAAA;;AAChB,+BAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAASC,MAAT,EAAmB;AAClC,gCAAIC,UAAS,MAAKL,WAAL,CAAiBM,WAAjB,CAA6B,CAAC,MAAKP,MAAN,CAA7B,EAA2C,WAA3C,EACYQ,WADZ,CACwB,MAAKR,MAD7B,EAEYS,GAFZ,CAEgBP,UAFhB,CAAb;;AAIAI,oCAAQI,SAAR,GAAoB;AAAA,uCAAKN,QAAQO,CAAR,CAAL;AAAA,6BAApB;AACAL,oCAAQM,OAAR,GAAkB;AAAA,uCAAKP,OAAOM,EAAEE,MAAF,CAASC,KAAhB,CAAL;AAAA,6BAAlB;AACH,yBAPM,CAAP;AAQH;;;iDAEW;AAAA;;AACR,+BAAO,IAAIX,OAAJ,CAAY,UAACC,OAAD,EAASC,MAAT,EAAmB;AAClC,gCAAIU,SAAS,OAAKd,WAAL,CAAiBM,WAAjB,CAA6B,CAAC,OAAKP,MAAN,CAA7B,EAA2C,WAA3C,EACiBQ,WADjB,CAC6B,OAAKR,MADlC,EAEiBgB,UAFjB,EAAb;;AAIA,gCAAIC,cAAc,EAAlB;AACAF,mCAAOL,SAAP,GAAmB,aAAK;AACpB,oCAAG,OAAKQ,wBAAL,CAA8BP,EAAEE,MAAF,CAASM,MAAvC,EAA8CF,WAA9C,CAAH,EAA8D;AAC1Db,4CAAQa,WAAR;AACH;AACJ,6BAJD;AAKH,yBAXM,CAAP;AAYH;;;6DAEwBG,S,EAAUH,W,EAAY;AAC3C,4BAAGG,SAAH,EAAa;AACT,gCAAIlB,aAAa,KAAKmB,aAAL,CAAmBD,UAAUE,KAA7B,CAAjB;AACAL,wCAAYM,IAAZ,CAAiBrB,UAAjB;AACAkB,sCAAUI,QAAV;AACA,mCAAO,KAAP;AACH;AACD,+BAAO,IAAP;AACH;;;kDAEaC,I,EAAK;AACf,+BAAO,IAAI5B,UAAJ,CAAe4B,KAAKC,KAApB,EAA0BD,KAAKE,WAA/B,EAA2CF,KAAKG,MAAhD,CAAP;AACH;;;iDAEW;AAAA;;AACR,+BAAO,IAAIzB,OAAJ,CAAY,UAACC,OAAD,EAASC,MAAT,EAAoB;;AAEnC,gCAAIC,UAAU,OAAKL,WAAL,CAAiBM,WAAjB,CAA6B,CAAC,OAAKP,MAAN,CAA7B,EAA2C,WAA3C,EACWQ,WADX,CACuB,OAAKR,MAD5B,EAEW6B,KAFX,EAAd;;AAIAvB,oCAAQI,SAAR,GAAoB;AAAA,uCAAKN,QAAQ,oCAAR,CAAL;AAAA,6BAApB;AACAE,oCAAQM,OAAR,GAAkB;AAAA,uCAAKP,OAAO,0CAAP,CAAL;AAAA,6BAAlB;AACH,yBARM,CAAP;AASH","file":"NegociacaoDao.js","sourcesContent":["import {Negociacao} from '../models/Negociacao';\n\nexport class NegociacaoDao{\n\n    constructor(connection){\n        this._store = 'negociacao';\n        this._connection = connection;\n    }\n\n    adiciona(negociacao){\n        return new Promise((resolve,reject) =>{                \n            let request =this._connection.transaction([this._store],'readwrite')\n                                    .objectStore(this._store)\n                                    .add(negociacao);\n\n            request.onsuccess = e => resolve(e);\n            request.onerror = e => reject(e.target.error);\n        });\n    }\n\n    listaTodos(){\n        return new Promise((resolve,reject) =>{\n            let cursor = this._connection.transaction([this._store],'readwrite')\n                                         .objectStore(this._store)\n                                         .openCursor()\n\n            let negociacoes = [];\n            cursor.onsuccess = e => {\n                if(this._processaResultadoCursor(e.target.result,negociacoes)){\n                    resolve(negociacoes);\n                }\n            }\n        })\n    }\n\n    _processaResultadoCursor(resultado,negociacoes){\n        if(resultado){\n            let negociacao = this._processaItem(resultado.value);\n            negociacoes.push(negociacao);\n            resultado.continue();\n            return false;\n        }\n        return true;\n    }\n\n    _processaItem(item){\n        return new Negociacao(item._data,item._quantidade,item._valor);\n    }\n\n    apagaTodas(){\n        return new Promise((resolve,reject) => {\n            \n            let request = this._connection.transaction([this._store],'readwrite')\n                                    .objectStore(this._store)\n                                    .clear();\n\n            request.onsuccess = e => resolve(\"Negociações removidas com sucesso!\");\n            request.onerror = e => reject(\"Não foi possível remover as negociações!\");    \n        });\n    }\n}"]}